---
title: https的握手过程
categories: 每日一题
date: 2019-04-01 20:20:37
tags: https
# description: 介绍 HTTPS 握手过程
---

> 当我们在浏览器的地址栏，敲下 `https://www.example.com` 到页面内容展示到我们面前的这个过程中，浏览器经历了什么？

<!-- more -->

### 一、嗅探 VS 加密

在网络链路的信息传输的过程中，如果通信链路中出现一个 `hacker`，那么明文展示的通信内容就会被 `hacker` 嗅探到，甚至通信内容都会被篡改。

为了防止明文泄密，那么就需要对明文进行加密，使得中间人无法获取信息。

目前主要分类两类加密方式：
- **对称加密：** 加密和解密时使用相同的密钥，或是使用两个可以简单地相互推算的密钥。
> 图示：`明文 <-> 密钥 <-> 密文`
> 常见的对称加密算法有DES、3DES、AES、Blowfish、IDEA、RC5、RC6。
> 优点：加密速度快
- **非对称加密：** 需要一对密钥（公钥和私钥）。任何人都可以拿到公钥进行明文加密，但是只有私钥持有者才能对密文进行解密。
> 图示：`明文 -> 公钥 -> 密文  -> 私钥 -> 明文`
> 优点：安全性更好 （暴力破解需要时间太长）

### 二、认证

虽然加密可以避免明文直接暴露，但是中间人还是可以欺骗双方的。例如浏览器向服务器请求时，中间人给你他的公钥，伪装成服务器与你通信。

现实生活中，个人可以通过政府发布的身份证进行证明。同样在虚拟的网络中，由大家都信任的 CA 组织，会给每个人出证明（**电子签名(digital signature)**，**电子证书(digital certificate)**）。

CA 组织将其他人的信息和公钥信息，用私钥加密成密文（即电子签名），签署到证书上即为电子证书。其他人通过 CA 的公钥进行解密，即可证明对方身份。在浏览器中，能够决定其他人的证书是否有效的公钥就是 **根证书**。

> 虽然加密和认证能保证通信信息的保密性，但是却无法保证通信信息的完整性。 **单向Hash函数**可以把输入变成一个定长的输出串，其特点就是无法从这个输出还原回输入内容，并且不同的输入几乎不可能产生相同的输出，拥有很好的抗碰撞性。因此服务器只要将明文内容做一个Hash运算得到一个Hash值，并一起加密传递过去给客户端。Hacker即便篡改了内容，客户端解密之后发现拿到的内容以及对应计算出来的Hash值与传递过来的不一致，说明这个包的完整性被破坏了。

![](/images/一次可靠的通信.png)

### 三、HTTPS三次握手


### 四、整个过程

![](/images/https握手图解.jpg)

### 相关讨论

https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/70

### 相关阅读

- [一次安全可靠的通信](https://developers.weixin.qq.com/community/develop/article/doc/000046a5fdc7802a15f7508b556413)
- [SSL/TLS协议运行机制的概述](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)
